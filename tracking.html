<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi de colis - ExpressDelivery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-messaging-compat.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            font-family: 'Poppins', sans-serif;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .tracking-container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .back-btn {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateX(-5px);
        }

        .tracking-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .tracking-steps {
            position: relative;
            margin-top: 30px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 30px;
            position: relative;
        }

        .step-icon {
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            z-index: 1;
            color: #333;
        }

        .step.active .step-icon {
            background: #23d5ab;
            color: white;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-date {
            font-size: 14px;
            opacity: 0.8;
        }

        .step-line {
            position: absolute;
            left: 15px;
            top: 30px;
            bottom: -30px;
            width: 2px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 0;
        }

        .step:last-child .step-line {
            display: none;
        }

        .package-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }

        .info-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .info-value {
            font-weight: 600;
        }

        .map-container {
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-options {
            margin-bottom: 30px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .share-btn.whatsapp {
            background: #25D366;
            color: white;
        }

        .share-btn.email {
            background: #EA4335;
            color: white;
        }

        .share-btn.copy {
            background: white;
            color: #333;
        }

        .detailed-history {
            margin-top: 30px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .notification-preferences {
            margin-top: 30px;
        }

        .notification-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            color: white;
            cursor: pointer;
        }

        #map {
            height: 400px;
            width: 100%;
            border-radius: 10px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .tracking-container {
                padding: 10px;
            }

            .package-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="tracking-container">
        <header class="header">
            <a href="dashboard.html" class="back-btn">‚Üê Retour au tableau de bord</a>
        </header>

        <div class="tracking-card">
            <div class="package-info">
                <div class="info-item">
                    <div class="info-label">Num√©ro de suivi</div>
                    <div class="info-value">ED123456789FR</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Statut</div>
                    <div class="info-value">En cours de livraison</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Date estim√©e de livraison</div>
                    <div class="info-value">24 Mars 2024</div>
                </div>
            </div>

            <div class="tracking-steps">
                <div class="step active">
                    <div class="step-icon">‚úì</div>
                    <div class="step-content">
                        <div class="step-title">Colis pris en charge</div>
                        <div class="step-date">22 Mars 2024, 09:30</div>
                    </div>
                    <div class="step-line"></div>
                </div>

                <div class="step active">
                    <div class="step-icon">‚úì</div>
                    <div class="step-content">
                        <div class="step-title">Arriv√© au centre de tri</div>
                        <div class="step-date">22 Mars 2024, 15:45</div>
                    </div>
                    <div class="step-line"></div>
                </div>

                <div class="step active">
                    <div class="step-icon">üì¶</div>
                    <div class="step-content">
                        <div class="step-title">En cours de livraison</div>
                        <div class="step-date">23 Mars 2024, 08:15</div>
                    </div>
                    <div class="step-line"></div>
                </div>

                <div class="step">
                    <div class="step-icon">üè†</div>
                    <div class="step-content">
                        <div class="step-title">Livr√©</div>
                        <div class="step-date">En attente</div>
                    </div>
                </div>
            </div>

            <div class="share-options">
                <h3>Partager le suivi</h3>
                <div class="share-buttons">
                    <button onclick="shareTracking('whatsapp')" class="share-btn whatsapp">
                        WhatsApp
                    </button>
                    <button onclick="shareTracking('email')" class="share-btn email">
                        Email
                    </button>
                    <button onclick="copyTrackingLink()" class="share-btn copy">
                        Copier le lien
                    </button>
                </div>
            </div>

            <div id="map" class="map-container"></div>

            <div class="detailed-history">
                <h3>Historique d√©taill√©</h3>
                <div class="history-list" id="historyList">
                    <!-- Rempli dynamiquement -->
                </div>
            </div>

            <div class="notification-preferences">
                <h3>Notifications</h3>
                <label class="notification-toggle">
                    <input type="checkbox" id="pushNotifications" onchange="toggleNotifications()">
                    Recevoir les notifications push
                </label>
                <label class="notification-toggle">
                    <input type="checkbox" id="emailNotifications" onchange="toggleEmailNotifications()">
                    Recevoir les notifications par email
                </label>
            </div>
        </div>
    </div>

    <script>
        // V√©rifier si l'utilisateur est connect√©
        document.addEventListener('DOMContentLoaded', () => {
            const userId = localStorage.getItem('userId');
            if (!userId) {
                window.location.href = 'login.html';
            }
        });

        // Simuler la mise √† jour en temps r√©el du statut
        setInterval(() => {
            const now = new Date();
            document.querySelector('.step.active .step-date').textContent = 
                `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }, 60000);

        // Initialisation de la carte
        const map = L.map('map').setView([48.8566, 2.3522], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Marqueur du colis
        const packageMarker = L.marker([48.8566, 2.3522]).addTo(map);
        
        // Simulation du mouvement du colis
        function simulatePackageMovement() {
            const newLat = 48.8566 + (Math.random() - 0.5) * 0.01;
            const newLng = 2.3522 + (Math.random() - 0.5) * 0.01;
            packageMarker.setLatLng([newLat, newLng]);
            map.panTo([newLat, newLng]);
        }

        // Mise √† jour toutes les 30 secondes
        setInterval(simulatePackageMovement, 30000);

        // Fonctions de partage
        function shareTracking(method) {
            const trackingUrl = window.location.href;
            
            if (method === 'whatsapp') {
                window.open(`https://wa.me/?text=Suivez mon colis: ${trackingUrl}`);
            } else if (method === 'email') {
                window.open(`mailto:?subject=Suivi de colis&body=Suivez mon colis: ${trackingUrl}`);
            }
        }

        function copyTrackingLink() {
            navigator.clipboard.writeText(window.location.href)
                .then(() => alert('Lien copi√© !'))
                .catch(err => console.error('Erreur lors de la copie:', err));
        }

        // Gestion des notifications
        async function toggleNotifications() {
            const checkbox = document.getElementById('pushNotifications');
            
            if (checkbox.checked) {
                try {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        const messaging = firebase.messaging();
                        const token = await messaging.getToken();
                        // Envoyer le token au serveur
                        console.log('Token:', token);
                    } else {
                        checkbox.checked = false;
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                    checkbox.checked = false;
                }
            }
        }

        // Historique d√©taill√©
        function updateHistory() {
            const historyList = document.getElementById('historyList');
            const now = new Date();
            
            const newEntry = document.createElement('div');
            newEntry.className = 'history-item';
            newEntry.innerHTML = `
                <div class="history-time">${now.toLocaleTimeString()}</div>
                <div class="history-event">Mise √† jour de la position du colis</div>
                <div class="history-location">Paris, France</div>
            `;
            
            historyList.insertBefore(newEntry, historyList.firstChild);
        }

        // Mise √† jour de l'historique toutes les minutes
        setInterval(updateHistory, 60000);

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            // V√©rifier les autorisations de notification
            if (Notification.permission === 'granted') {
                document.getElementById('pushNotifications').checked = true;
            }
            
            // Premi√®re mise √† jour de l'historique
            updateHistory();
        });
    </script>
</body>
</html> 